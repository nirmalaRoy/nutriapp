<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <system.webServer>
        <rewrite>
            <rules>
                <!-- API Routes for Products -->
                <rule name="API Products Search" stopProcessing="true">
                    <match url="^api/products/search/?$" />
                    <action type="Rewrite" url="api/products.cfm" appendQueryString="true" />
                    <serverVariables>
                        <set name="PATH_INFO" value="/search" />
                    </serverVariables>
                </rule>
                
                <rule name="API Products Categories" stopProcessing="true">
                    <match url="^api/products/categories/?$" />
                    <action type="Rewrite" url="api/products.cfm" appendQueryString="true" />
                    <serverVariables>
                        <set name="PATH_INFO" value="/categories" />
                    </serverVariables>
                </rule>
                
                <rule name="API Products Ratings" stopProcessing="true">
                    <match url="^api/products/ratings/?$" />
                    <action type="Rewrite" url="api/products.cfm" appendQueryString="true" />
                    <serverVariables>
                        <set name="PATH_INFO" value="/ratings" />
                    </serverVariables>
                </rule>
                
                <rule name="API Products Suggestions" stopProcessing="true">
                    <match url="^api/products/suggestions/([^/]+)/?$" />
                    <action type="Rewrite" url="api/products.cfm" appendQueryString="true" />
                    <serverVariables>
                        <set name="PATH_INFO" value="/suggestions/{R:1}" />
                    </serverVariables>
                </rule>
                
                <rule name="API Products by ID" stopProcessing="true">
                    <match url="^api/products/([^/]+)/?$" />
                    <action type="Rewrite" url="api/products.cfm" appendQueryString="true" />
                    <serverVariables>
                        <set name="PATH_INFO" value="/{R:1}" />
                    </serverVariables>
                </rule>
                
                <rule name="API Products Base" stopProcessing="true">
                    <match url="^api/products/?$" />
                    <action type="Rewrite" url="api/products.cfm" appendQueryString="true" />
                    <serverVariables>
                        <set name="PATH_INFO" value="/api/products" />
                    </serverVariables>
                </rule>
                
                <!-- API Routes for Auth -->
                <rule name="API Auth Login" stopProcessing="true">
                    <match url="^api/auth/login/?$" />
                    <action type="Rewrite" url="api/auth.cfm" appendQueryString="true" />
                    <serverVariables>
                        <set name="PATH_INFO" value="/login" />
                    </serverVariables>
                </rule>
                
                <rule name="API Auth Register" stopProcessing="true">
                    <match url="^api/auth/register/?$" />
                    <action type="Rewrite" url="api/auth.cfm" appendQueryString="true" />
                    <serverVariables>
                        <set name="PATH_INFO" value="/register" />
                    </serverVariables>
                </rule>
                
                <rule name="API Auth Logout" stopProcessing="true">
                    <match url="^api/auth/logout/?$" />
                    <action type="Rewrite" url="api/auth.cfm" appendQueryString="true" />
                    <serverVariables>
                        <set name="PATH_INFO" value="/logout" />
                    </serverVariables>
                </rule>
                
                <rule name="API Auth Validate" stopProcessing="true">
                    <match url="^api/auth/validate/?$" />
                    <action type="Rewrite" url="api/auth.cfm" appendQueryString="true" />
                    <serverVariables>
                        <set name="PATH_INFO" value="/validate" />
                    </serverVariables>
                </rule>
                
                <rule name="API Auth Me" stopProcessing="true">
                    <match url="^api/auth/me/?$" />
                    <action type="Rewrite" url="api/auth.cfm" appendQueryString="true" />
                    <serverVariables>
                        <set name="PATH_INFO" value="/me" />
                    </serverVariables>
                </rule>
            </rules>
        </rewrite>
    </system.webServer>
</configuration>
